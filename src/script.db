-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.ambientes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nome text NOT NULL,
  CONSTRAINT ambientes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.checklist_itens (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  ambiente_id uuid NOT NULL,
  categoria text NOT NULL,
  descricao text NOT NULL,
  CONSTRAINT checklist_itens_pkey PRIMARY KEY (id),
  CONSTRAINT checklist_itens_ambiente_id_fkey FOREIGN KEY (ambiente_id) REFERENCES public.ambientes(id)
);
CREATE TABLE public.clientes (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  nome text NOT NULL,
  telefone text,
  email text,
  criado_em timestamp with time zone DEFAULT now(),
  CONSTRAINT clientes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.empreendimentos (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  nome text NOT NULL,
  endereco text NOT NULL,
  criado_em timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  cliente text,
  CONSTRAINT empreendimentos_pkey PRIMARY KEY (id)
);
CREATE TABLE public.engenheiros (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  nome text NOT NULL,
  crea text NOT NULL UNIQUE,
  telefone text,
  criado_em timestamp with time zone DEFAULT now(),
  CONSTRAINT engenheiros_pkey PRIMARY KEY (id)
);
CREATE TABLE public.fotos_vistoria (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  item_id uuid NOT NULL,
  storage_path text NOT NULL,
  tipo USER-DEFINED NOT NULL,
  criado_em timestamp with time zone DEFAULT now(),
  CONSTRAINT fotos_vistoria_pkey PRIMARY KEY (id),
  CONSTRAINT fotos_vistoria_item_id_fkey FOREIGN KEY (item_id) REFERENCES public.itens_vistoria(id)
);
CREATE TABLE public.itens_vistoria (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  vistoria_id uuid NOT NULL,
  ambiente_id uuid,
  numero_item integer,
  descricao_defeito text,
  observacao_interna text,
  status USER-DEFINED NOT NULL DEFAULT 'pendente'::status_item,
  item_original_id uuid,
  criado_em timestamp with time zone DEFAULT now(),
  checklist_item_id bigint,
  item_origem_id uuid,
  resolucao_obs text,
  CONSTRAINT itens_vistoria_pkey PRIMARY KEY (id),
  CONSTRAINT itens_vistoria_vistoria_id_fkey FOREIGN KEY (vistoria_id) REFERENCES public.vistorias(id),
  CONSTRAINT itens_vistoria_item_original_id_fkey FOREIGN KEY (item_original_id) REFERENCES public.itens_vistoria(id),
  CONSTRAINT itens_vistoria_checklist_item_id_fkey FOREIGN KEY (checklist_item_id) REFERENCES public.checklist_itens(id),
  CONSTRAINT itens_origem_fk FOREIGN KEY (item_origem_id) REFERENCES public.itens_vistoria(id)
);
CREATE TABLE public.unidades (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empreendimento_id uuid NOT NULL,
  cliente_id uuid,
  codigo text NOT NULL,
  andar integer,
  criado_em timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT unidades_pkey PRIMARY KEY (id),
  CONSTRAINT unidades_empreendimento_id_fkey FOREIGN KEY (empreendimento_id) REFERENCES public.empreendimentos(id),
  CONSTRAINT unidades_cliente_id_fkey FOREIGN KEY (cliente_id) REFERENCES public.clientes(id)
);
CREATE TABLE public.vistorias (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  unidade_id uuid NOT NULL,
  engenheiro_id uuid NOT NULL,
  vistoria_pai_id uuid,
  data_vistoria date NOT NULL,
  status USER-DEFINED NOT NULL DEFAULT 'pendente'::status_vistoria,
  observacoes text,
  criado_em timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  status_aprovacao text DEFAULT 'pendente'::text,
  chaves_entregues boolean DEFAULT false,
  foto_chaves text,
  observacao_final text,
  tipo_vistoria text NOT NULL CHECK (tipo_vistoria = ANY (ARRAY['construtora'::text, 'entrada'::text, 'entrega'::text, 'revistoria'::text])),
  revisao_num integer,
  relatorio_url text,
  data_agendada date,
  CONSTRAINT vistorias_pkey PRIMARY KEY (id),
  CONSTRAINT vistorias_unidade_id_fkey FOREIGN KEY (unidade_id) REFERENCES public.unidades(id),
  CONSTRAINT vistorias_engenheiro_id_fkey FOREIGN KEY (engenheiro_id) REFERENCES public.engenheiros(id),
  CONSTRAINT vistorias_vistoria_pai_id_fkey FOREIGN KEY (vistoria_pai_id) REFERENCES public.vistorias(id),
  CONSTRAINT vistorias_pai_fk FOREIGN KEY (vistoria_pai_id) REFERENCES public.vistorias(id)
);